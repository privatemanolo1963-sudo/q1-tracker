<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Q1 Tracker">
  <meta name="theme-color" content="#0a0a0a">
  <title>Q1 Tracker</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent;
    }
    
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #0a0a0a 0%, #1a1a2e 100%);
      font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      color: #ffffff;
      padding: 20px;
      padding-top: env(safe-area-inset-top, 20px);
      padding-bottom: calc(env(safe-area-inset-bottom, 20px) + 40px);
    }
    
    .container {
      max-width: 480px;
      margin: 0 auto;
    }
    
    .card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 16px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }
    
    .card:active {
      transform: scale(0.98);
    }
    
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .card-title {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      color: rgba(255, 255, 255, 0.5);
      font-weight: 500;
    }
    
    .emoji {
      font-size: 24px;
    }
    
    .toggle-btn {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: none;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }
    
    .toggle-done {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
    }
    
    .toggle-pending {
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.7);
      border: 1px dashed rgba(255, 255, 255, 0.2);
    }
    
    .toggle-pending:active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }
    
    .toggle-wine-ok {
      background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
      color: white;
    }
    
    .toggle-wine-no {
      background: rgba(239, 68, 68, 0.2);
      color: #fca5a5;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .input-field {
      width: 100%;
      padding: 16px;
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      font-size: 24px;
      font-family: 'Space Mono', monospace;
      font-weight: 700;
      text-align: center;
      outline: none;
      transition: all 0.2s ease;
    }
    
    .input-field:focus {
      border-color: rgba(99, 102, 241, 0.5);
      background: rgba(99, 102, 241, 0.1);
    }
    
    .input-field::placeholder {
      color: rgba(255, 255, 255, 0.3);
    }
    
    .unit {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 8px;
      text-align: center;
    }
    
    .progress-container {
      margin-top: 20px;
    }
    
    .progress-bar {
      height: 8px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #6366f1 0%, #8b5cf6 100%);
      border-radius: 4px;
      transition: width 0.5s ease;
    }
    
    .progress-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 8px;
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      font-family: 'Space Mono', monospace;
    }
    
    .week-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 8px;
      margin-top: 12px;
    }
    
    .week-day {
      text-align: center;
      padding: 8px 4px;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.03);
    }
    
    .week-day-name {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.4);
      margin-bottom: 4px;
    }
    
    .week-day-status {
      font-size: 16px;
    }
    
    .tab-container {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
    }
    
    .tab {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
    }
    
    .tab-active {
      background: rgba(99, 102, 241, 0.2);
      color: #a5b4fc;
      border: 1px solid rgba(99, 102, 241, 0.3);
    }
    
    .tab-inactive {
      background: rgba(255, 255, 255, 0.03);
      color: rgba(255, 255, 255, 0.5);
      border: 1px solid transparent;
    }
    
    .tab-inactive:active {
      background: rgba(255, 255, 255, 0.08);
      color: rgba(255, 255, 255, 0.8);
    }
    
    .schedule-hint {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.4);
      margin-top: 8px;
      text-align: center;
    }
    
    .target-badge {
      display: inline-block;
      padding: 4px 10px;
      background: rgba(16, 185, 129, 0.2);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 20px;
      font-size: 11px;
      color: #6ee7b7;
      font-weight: 500;
    }
    
    .header {
      text-align: center;
      margin-bottom: 32px;
      padding-top: 20px;
    }
    
    .header-date {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 2px;
    }
    
    .header-title {
      font-size: 28px;
      font-weight: 700;
      margin: 0;
    }
    
    .rest-day {
      background: rgba(255, 255, 255, 0.02);
      border: 1px dashed rgba(255, 255, 255, 0.1);
    }
    
    .rest-day-text {
      text-align: center;
      color: rgba(255, 255, 255, 0.3);
      font-size: 14px;
      padding: 8px;
    }
    
    .water-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }
    
    .water-btn {
      padding: 16px 8px;
      border-radius: 12px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    
    .water-done {
      background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
      color: white;
      box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3);
    }
    
    .water-pending {
      background: rgba(255, 255, 255, 0.05);
      color: rgba(255, 255, 255, 0.7);
      border: 1px dashed rgba(255, 255, 255, 0.2);
    }
    
    .dual-input {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
    }
    
    .mini-input {
      padding: 12px;
      font-size: 18px;
    }
    
    .input-label {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 6px;
      display: block;
    }
    
    .week-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 12px 16px;
      background: rgba(255, 255, 255, 0.03);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .week-nav-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 10px;
      font-size: 18px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .week-nav-btn:active {
      background: rgba(255, 255, 255, 0.2);
    }
    
    .week-nav-btn:disabled {
      opacity: 0.3;
      cursor: not-allowed;
    }
    
    .week-nav-label {
      font-size: 14px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.8);
    }
    
    .footer {
      text-align: center;
      margin-top: 32px;
      padding-bottom: 40px;
      color: rgba(255, 255, 255, 0.3);
      font-size: 12px;
    }
    
    .reset-btn {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.3);
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 11px;
      cursor: pointer;
      margin-top: 16px;
      font-family: inherit;
    }
    
    .save-indicator {
      font-size: 14px;
      opacity: 0.6;
      margin-left: 8px;
    }
    
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="header-date" id="current-date"></div>
      <h1 class="header-title">Q1 Tracker <span class="save-indicator" id="save-status"></span></h1>
      <div style="margin-top: 12px;">
        <span class="target-badge">üéØ Obiettivo: 89 kg entro 30/03</span>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tab-container">
      <button class="tab tab-active" id="tab-today" onclick="showTab('today')">Oggi</button>
      <button class="tab tab-inactive" id="tab-week" onclick="showTab('week')">Settimana</button>
    </div>

    <!-- Today View -->
    <div id="view-today">
      <!-- Weight Card -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Peso</span>
          <span class="emoji">‚öñÔ∏è</span>
        </div>
        <input type="number" step="0.1" class="input-field" placeholder="--.-" id="weight-input" inputmode="decimal" onchange="updateField('weight', this.value)">
        <div class="unit">kg</div>
        <div class="progress-container">
          <div class="progress-bar">
            <div class="progress-fill" id="weight-progress"></div>
          </div>
          <div class="progress-labels">
            <span>95 kg</span>
            <span id="weight-percent">0%</span>
            <span>89 kg</span>
          </div>
        </div>
      </div>

      <!-- Gymnastics Card -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Ginnastica Mattutina</span>
          <span class="emoji">üßò</span>
        </div>
        <button class="toggle-btn toggle-pending" id="gym-btn" onclick="toggleField('gym')">Programma</button>
        <div class="schedule-hint" id="gym-hint"></div>
      </div>

      <!-- Run Card -->
      <div class="card" id="run-card">
        <div class="card-header">
          <span class="card-title">Corsa</span>
          <span class="emoji">üèÉ</span>
        </div>
        <div id="run-content"></div>
      </div>

      <!-- Water Card -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Acqua (3 √ó 0.5L)</span>
          <span class="emoji">üíß</span>
        </div>
        <div class="water-grid">
          <button class="water-btn water-pending" id="water1-btn" onclick="toggleField('water1')">
            <span style="font-size: 20px;">üíß</span>
            <span>0.5L</span>
          </button>
          <button class="water-btn water-pending" id="water2-btn" onclick="toggleField('water2')">
            <span style="font-size: 20px;">üíß</span>
            <span>0.5L</span>
          </button>
          <button class="water-btn water-pending" id="water3-btn" onclick="toggleField('water3')">
            <span style="font-size: 20px;">üíß</span>
            <span>0.5L</span>
          </button>
        </div>
        <div class="schedule-hint" id="water-hint">0/3 completati ‚Äî 0L bevuti</div>
      </div>

      <!-- Wine Card -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Vino</span>
          <span class="emoji">üç∑</span>
        </div>
        <div id="wine-content"></div>
        <div class="schedule-hint" id="wine-hint"></div>
      </div>

      <!-- Blood Pressure Card -->
      <div class="card" id="pressure-card">
        <div class="card-header">
          <span class="card-title">Pressione</span>
          <span class="emoji">‚ù§Ô∏è</span>
        </div>
        <div id="pressure-content"></div>
      </div>

      <!-- Creatinine Card -->
      <div class="card" id="creatinine-card">
        <div class="card-header">
          <span class="card-title">Creatinina</span>
          <span class="emoji">üî¨</span>
        </div>
        <div id="creatinine-content"></div>
      </div>
    </div>

    <!-- Week View -->
    <div id="view-week" class="hidden">
      <!-- Week Navigation -->
      <div class="week-nav">
        <button class="week-nav-btn" id="week-prev" onclick="changeWeek(-1)">‚Üê</button>
        <span class="week-nav-label" id="week-label">Questa settimana</span>
        <button class="week-nav-btn" id="week-next" onclick="changeWeek(1)">‚Üí</button>
      </div>

      <!-- Weight Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Peso</span>
          <span class="emoji">üìä</span>
        </div>
        <div class="week-grid" id="week-weight"></div>
      </div>

      <!-- Gymnastics Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Ginnastica</span>
          <span class="emoji">üßò</span>
        </div>
        <div class="week-grid" id="week-gym"></div>
        <div class="schedule-hint" id="week-gym-summary"></div>
      </div>

      <!-- Run Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Corse</span>
          <span class="emoji">üèÉ</span>
        </div>
        <div class="week-grid" id="week-run"></div>
        <div class="schedule-hint" id="week-run-summary"></div>
      </div>

      <!-- Water Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Acqua ‚Äî Litri</span>
          <span class="emoji">üíß</span>
        </div>
        <div class="week-grid" id="week-water"></div>
        <div class="schedule-hint">Obiettivo: 1.5L al giorno</div>
      </div>

      <!-- Wine Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Vino</span>
          <span class="emoji">üç∑</span>
        </div>
        <div class="week-grid" id="week-wine"></div>
        <div class="schedule-hint">üç∑ = bevuto (Ven-Sab) ‚Ä¢ ‚úÖ = confermato no vino (Dom-Gio)</div>
      </div>

      <!-- Pressure Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Pressione ‚Äî Valori</span>
          <span class="emoji">‚ù§Ô∏è</span>
        </div>
        <div class="week-grid" id="week-pressure"></div>
        <div class="schedule-hint">Misurazione: Marted√¨ e Venerd√¨</div>
      </div>

      <!-- Creatinine Weekly -->
      <div class="card">
        <div class="card-header">
          <span class="card-title">Creatinina ‚Äî Valori</span>
          <span class="emoji">üî¨</span>
        </div>
        <div class="week-grid" id="week-creatinine"></div>
        <div class="schedule-hint">Controllo ogni 2 mercoled√¨ ‚Ä¢ Obiettivo: 130</div>
      </div>
    </div>

    <!-- Footer -->
    <div class="footer">
      Q1 2026 ‚Ä¢ Obiettivo 30 Marzo
      <div>
        <button class="reset-btn" onclick="resetData()">Reset dati</button>
      </div>
    </div>
  </div>

  <script>
    // Data storage
    let data = {};
    let weekOffset = 0;
    const STORAGE_KEY = 'q1-tracker-data-v2';

    // Day names
    const dayNames = ['Domenica', 'Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'];
    const dayNamesShort = ['Dom', 'Lun', 'Mar', 'Mer', 'Gio', 'Ven', 'Sab'];
    const monthNames = ['Gennaio', 'Febbraio', 'Marzo', 'Aprile', 'Maggio', 'Giugno', 'Luglio', 'Agosto', 'Settembre', 'Ottobre', 'Novembre', 'Dicembre'];
    const monthNamesShort = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];

    // Gym schedule: 0=Sun, 1=Mon, etc.
    const gymSchedule = { 0: 'short', 1: 'long', 2: 'short', 3: 'long', 4: 'short', 5: 'long', 6: 'short' };

    // Check if it's a creatinine week
    function isCreatinineWeek(date) {
      const referenceDate = new Date('2025-01-01');
      const diffTime = date.getTime() - referenceDate.getTime();
      const diffWeeks = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7));
      return diffWeeks % 2 === 0;
    }

    // Initialize
    function init() {
      loadData();
      updateUI();
    }

    // Load data from localStorage
    function loadData() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        if (stored) {
          data = JSON.parse(stored);
        }
      } catch (e) {
        console.error('Failed to load data:', e);
        data = {};
      }
    }

    // Save data to localStorage
    function saveData() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        showSaveStatus('‚úì');
      } catch (e) {
        console.error('Failed to save data:', e);
        showSaveStatus('‚ö†Ô∏è');
      }
    }

    // Show save status indicator
    function showSaveStatus(status) {
      const el = document.getElementById('save-status');
      el.textContent = status;
      setTimeout(() => { el.textContent = ''; }, 1500);
    }

    // Get today's key
    function getTodayKey() {
      return new Date().toISOString().split('T')[0];
    }

    // Get today's data
    function getTodayData() {
      return data[getTodayKey()] || {};
    }

    // Update a field
    function updateField(field, value) {
      const key = getTodayKey();
      if (!data[key]) data[key] = {};
      data[key][field] = value;
      saveData();
      updateUI();
    }

    // Toggle a boolean field
    function toggleField(field) {
      const key = getTodayKey();
      if (!data[key]) data[key] = {};
      data[key][field] = !data[key][field];
      saveData();
      updateUI();
    }

    // Get week data
    function getWeekData() {
      const weekData = [];
      const today = new Date();
      const baseDate = new Date(today);
      baseDate.setDate(baseDate.getDate() + (weekOffset * 7));
      
      for (let i = 6; i >= 0; i--) {
        const date = new Date(baseDate);
        date.setDate(date.getDate() - i);
        const key = date.toISOString().split('T')[0];
        weekData.push({
          date: date,
          key: key,
          data: data[key] || {},
          dayName: dayNamesShort[date.getDay()],
          dayOfWeek: date.getDay()
        });
      }
      return weekData;
    }

    // Change week
    function changeWeek(delta) {
      if (delta > 0 && weekOffset >= 0) return;
      weekOffset += delta;
      updateWeekView();
      document.getElementById('week-next').disabled = weekOffset >= 0;
    }

    // Get week label
    function getWeekLabel() {
      if (weekOffset === 0) return 'Questa settimana';
      if (weekOffset === -1) return 'Settimana scorsa';
      const weekData = getWeekData();
      const firstDay = weekData[0].date;
      const lastDay = weekData[6].date;
      return `${firstDay.getDate()} ${monthNamesShort[firstDay.getMonth()]} - ${lastDay.getDate()} ${monthNamesShort[lastDay.getMonth()]}`;
    }

    // Update the entire UI
    function updateUI() {
      const today = new Date();
      const dayOfWeek = today.getDay();
      const todayData = getTodayData();

      // Update header date
      document.getElementById('current-date').textContent = 
        `${dayNames[dayOfWeek]} ${today.getDate()} ${monthNames[today.getMonth()]}`;

      // Weight
      document.getElementById('weight-input').value = todayData.weight || '';
      updateWeightProgress(todayData.weight);

      // Gymnastics
      const gymType = gymSchedule[dayOfWeek];
      const gymBtn = document.getElementById('gym-btn');
      const gymHint = document.getElementById('gym-hint');
      
      if (todayData.gym) {
        gymBtn.className = 'toggle-btn toggle-done';
        gymBtn.textContent = '‚úì Fatto!';
      } else {
        gymBtn.className = 'toggle-btn toggle-pending';
        gymBtn.textContent = `Programma ${gymType === 'long' ? 'LONG' : 'SHORT'}`;
      }
      gymHint.textContent = `Oggi: ${gymType === 'long' ? 'üí™ Sessione lunga' : '‚ö° Sessione breve'}`;

      // Run
      const isRunDay = dayOfWeek === 1 || dayOfWeek === 3;
      const runContent = document.getElementById('run-content');
      const runCard = document.getElementById('run-card');
      
      if (isRunDay) {
        runCard.className = 'card';
        if (todayData.run) {
          runContent.innerHTML = `<button class="toggle-btn toggle-done" onclick="toggleField('run')">‚úì Fatto!</button><div class="schedule-hint">Programmata per le 18:00</div>`;
        } else {
          runContent.innerHTML = `<button class="toggle-btn toggle-pending" onclick="toggleField('run')">Segna come fatto</button><div class="schedule-hint">Programmata per le 18:00</div>`;
        }
      } else {
        runCard.className = 'card rest-day';
        const nextRun = dayOfWeek < 1 ? 'Luned√¨' : dayOfWeek < 3 ? 'Mercoled√¨' : 'Luned√¨';
        runContent.innerHTML = `<div class="rest-day-text">Giorno di riposo ‚Äî prossima corsa: ${nextRun}</div>`;
      }

      // Water
      ['water1', 'water2', 'water3'].forEach(w => {
        const btn = document.getElementById(`${w}-btn`);
        btn.className = `water-btn ${todayData[w] ? 'water-done' : 'water-pending'}`;
      });
      const waterCount = (todayData.water1 ? 1 : 0) + (todayData.water2 ? 1 : 0) + (todayData.water3 ? 1 : 0);
      document.getElementById('water-hint').textContent = `${waterCount}/3 completati ‚Äî ${waterCount * 0.5}L bevuti`;

      // Wine
      const isWineAllowed = dayOfWeek === 5 || dayOfWeek === 6;
      const wineContent = document.getElementById('wine-content');
      const wineHint = document.getElementById('wine-hint');

      if (isWineAllowed) {
        if (todayData.wine) {
          wineContent.innerHTML = `<button class="toggle-btn toggle-wine-ok" onclick="toggleField('wine')">üç∑ Vino bevuto</button>`;
        } else {
          wineContent.innerHTML = `<button class="toggle-btn toggle-pending" onclick="toggleField('wine')">Segna se bevi vino</button>`;
        }
        wineHint.textContent = 'Ven-Sab: consentito';
      } else {
        if (todayData.noWine) {
          wineContent.innerHTML = `<button class="toggle-btn toggle-done" onclick="toggleField('noWine')">‚úì Confermato: no vino oggi</button>`;
        } else {
          wineContent.innerHTML = `<button class="toggle-btn toggle-pending" onclick="toggleField('noWine')">Conferma: niente vino oggi</button>`;
        }
        wineHint.textContent = 'Dom-Gio: no vino';
      }

      // Blood pressure
      const isPressureDay = dayOfWeek === 2 || dayOfWeek === 5;
      const pressureCard = document.getElementById('pressure-card');
      const pressureContent = document.getElementById('pressure-content');

      if (isPressureDay) {
        pressureCard.className = 'card';
        pressureContent.innerHTML = `
          <div class="dual-input" style="margin-bottom: 12px;">
            <div>
              <label class="input-label">Sistolica</label>
              <input type="number" class="input-field mini-input" placeholder="---" id="systolic-input" inputmode="numeric" value="${todayData.systolic || ''}" onchange="updateField('systolic', this.value)">
            </div>
            <div>
              <label class="input-label">Diastolica</label>
              <input type="number" class="input-field mini-input" placeholder="--" id="diastolic-input" inputmode="numeric" value="${todayData.diastolic || ''}" onchange="updateField('diastolic', this.value)">
            </div>
          </div>
          <div class="schedule-hint">Giorno di misurazione (Mar/Ven)</div>
        `;
      } else {
        pressureCard.className = 'card rest-day';
        const nextPressure = dayOfWeek < 2 ? 'Marted√¨' : dayOfWeek < 5 ? 'Venerd√¨' : 'Marted√¨';
        pressureContent.innerHTML = `<div class="rest-day-text">Prossima misurazione: ${nextPressure}</div>`;
      }

      // Creatinine
      const isCreatinineDay = dayOfWeek === 3 && isCreatinineWeek(today);
      const creatinineCard = document.getElementById('creatinine-card');
      const creatinineContent = document.getElementById('creatinine-content');

      if (isCreatinineDay) {
        creatinineCard.className = 'card';
        creatinineContent.innerHTML = `
          <input type="number" class="input-field" placeholder="---" id="creatinine-input" inputmode="numeric" value="${todayData.creatinineValue || ''}" onchange="updateField('creatinineValue', this.value)">
          <div class="unit">Œºmol/L ‚Äî Obiettivo: 130</div>
          <div class="schedule-hint">Controllo ogni 2 settimane (Mercoled√¨)</div>
        `;
      } else {
        creatinineCard.className = 'card rest-day';
        creatinineContent.innerHTML = `<div class="rest-day-text">Controllo ogni 2 mercoled√¨</div>`;
      }

      // Update week view if visible
      updateWeekView();
    }

    // Update weight progress bar
    function updateWeightProgress(weight) {
      const startWeight = 95;
      const targetWeight = 89;
      const currentWeight = weight ? parseFloat(weight) : startWeight;
      const percent = Math.min(100, Math.max(0, ((startWeight - currentWeight) / (startWeight - targetWeight)) * 100));
      
      document.getElementById('weight-progress').style.width = `${percent}%`;
      document.getElementById('weight-percent').textContent = `${percent.toFixed(0)}%`;
    }

    // Update week view
    function updateWeekView() {
      const weekData = getWeekData();

      // Week label
      document.getElementById('week-label').textContent = getWeekLabel();
      document.getElementById('week-next').disabled = weekOffset >= 0;

      // Weight
      document.getElementById('week-weight').innerHTML = weekData.map(day => `
        <div class="week-day">
          <div class="week-day-name">${day.dayName}</div>
          <div class="week-day-status" style="font-family: 'Space Mono', monospace; font-size: 12px; color: ${day.data.weight ? '#a5b4fc' : 'rgba(255,255,255,0.2)'};">
            ${day.data.weight || '‚Äî'}
          </div>
        </div>
      `).join('');

      // Gymnastics
      document.getElementById('week-gym').innerHTML = weekData.map(day => {
        const gymType = gymSchedule[day.dayOfWeek];
        return `
          <div class="week-day">
            <div class="week-day-name">${day.dayName}</div>
            <div class="week-day-status">${day.data.gym ? (gymType === 'long' ? 'üí™' : '‚ö°') : '‚¨ú'}</div>
          </div>
        `;
      }).join('');
      document.getElementById('week-gym-summary').textContent = `Sessioni fatte: ${weekData.filter(d => d.data.gym).length} / 7 ‚Ä¢ üí™ = long, ‚ö° = short`;

      // Run
      document.getElementById('week-run').innerHTML = weekData.map(day => {
        const isRunDay = day.dayOfWeek === 1 || day.dayOfWeek === 3;
        return `
          <div class="week-day">
            <div class="week-day-name">${day.dayName}</div>
            <div class="week-day-status">${isRunDay ? (day.data.run ? '‚úÖ' : '‚¨ú') : '¬∑'}</div>
          </div>
        `;
      }).join('');
      const runDays = weekData.filter(d => d.dayOfWeek === 1 || d.dayOfWeek === 3);
      document.getElementById('week-run-summary').textContent = `Corse fatte: ${weekData.filter(d => d.data.run).length} / ${runDays.length} programmate`;

      // Water
      document.getElementById('week-water').innerHTML = weekData.map(day => {
        const waterCount = (day.data.water1 ? 1 : 0) + (day.data.water2 ? 1 : 0) + (day.data.water3 ? 1 : 0);
        const liters = waterCount * 0.5;
        return `
          <div class="week-day">
            <div class="week-day-name">${day.dayName}</div>
            <div class="week-day-status" style="font-family: 'Space Mono', monospace; font-size: 12px; color: ${liters > 0 ? '#0ea5e9' : 'rgba(255,255,255,0.2)'};">
              ${liters > 0 ? `${liters}L` : '‚Äî'}
            </div>
          </div>
        `;
      }).join('');

      // Wine
      document.getElementById('week-wine').innerHTML = weekData.map(day => {
        const isAllowed = day.dayOfWeek === 5 || day.dayOfWeek === 6;
        let status = '¬∑';
        if (isAllowed) {
          status = day.data.wine ? 'üç∑' : '¬∑';
        } else {
          status = day.data.noWine ? '‚úÖ' : '‚¨ú';
        }
        return `
          <div class="week-day">
            <div class="week-day-name">${day.dayName}</div>
            <div class="week-day-status">${status}</div>
          </div>
        `;
      }).join('');

      // Pressure
      document.getElementById('week-pressure').innerHTML = weekData.map(day => {
        const isPressureDay = day.dayOfWeek === 2 || day.dayOfWeek === 5;
        const hasValue = day.data.systolic && day.data.diastolic;
        return `
          <div class="week-day">
            <div class="week-day-name">${day.dayName}</div>
            <div class="week-day-status" style="font-family: 'Space Mono', monospace; font-size: 9px; color: ${hasValue ? '#f472b6' : 'rgba(255,255,255,0.2)'};">
              ${isPressureDay ? (hasValue ? `${day.data.systolic}/${day.data.diastolic}` : '‚Äî') : '¬∑'}
            </div>
          </div>
        `;
      }).join('');

      // Creatinine
      document.getElementById('week-creatinine').innerHTML = weekData.map(day => {
        const isCreatDay = day.dayOfWeek === 3 && isCreatinineWeek(day.date);
        const hasValue = day.data.creatinineValue;
        return `
          <div class="week-day">
            <div class="week-day-name">${day.dayName}</div>
            <div class="week-day-status" style="font-family: 'Space Mono', monospace; font-size: 11px; color: ${hasValue ? '#a78bfa' : 'rgba(255,255,255,0.2)'};">
              ${isCreatDay ? (hasValue ? hasValue : '‚Äî') : '¬∑'}
            </div>
          </div>
        `;
      }).join('');
    }

    // Show tab
    function showTab(tab) {
      document.getElementById('view-today').classList.toggle('hidden', tab !== 'today');
      document.getElementById('view-week').classList.toggle('hidden', tab !== 'week');
      document.getElementById('tab-today').className = `tab ${tab === 'today' ? 'tab-active' : 'tab-inactive'}`;
      document.getElementById('tab-week').className = `tab ${tab === 'week' ? 'tab-active' : 'tab-inactive'}`;
      if (tab === 'week') {
        weekOffset = 0;
        updateWeekView();
      }
    }

    // Reset data
    function resetData() {
      if (confirm('Sei sicuro di voler cancellare tutti i dati?')) {
        localStorage.removeItem(STORAGE_KEY);
        data = {};
        updateUI();
      }
    }

    // Initialize on load
    init();
  </script>
</body>
</html>
